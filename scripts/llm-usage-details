#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

OUT=$($SCRIPT_DIR/waybar-llm-usage.sh)
printf '%s' "$OUT" | python3 -c 'import json,sys,re
try:
    data=json.load(sys.stdin)
    tip=data.get("tooltip", "")
    tip=tip.replace("\\n", "\n")
    tip=tip.replace("\\r", "")
    # strip pango spans for terminal readability
    tip=re.sub(r"<span[^>]*>", "", tip)
    tip=tip.replace("</span>", "")
    print(tip)
except Exception:
    raw=sys.stdin.read()
    print("(failed to parse tooltip)")
    print(raw)'

echo
read -p "Press Enter..."
